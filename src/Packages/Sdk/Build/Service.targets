<Project>

  <PropertyGroup>
    <ServiceName>Pillr</ServiceName>
    <ServiceDisplayName>Pillr Service</ServiceDisplayName>
    <ServiceDescription></ServiceDescription>
    <ServiceBinPath>$(ProjectDir)..\Pillr.Service\bin\Debug\net8.0\Pillr.Service.exe</ServiceBinPath>
    <ServiceFound>false</ServiceFound>
  </PropertyGroup>

  <Target Name="InstallService">
    <!-- Search for the service and return the exit code -->
    <Exec
      Command="sc.exe query $(ServiceName) type=service"
      ConsoleToMsBuild="false"
      IgnoreExitCode="true"
      EchoOff="true"
      StandardOutputImportance="low"
      StandardErrorImportance="low"
    >
      <Output TaskParameter="ExitCode" PropertyName="ExitCode" />
    </Exec>

    <!-- Use the exit code to create a boolean property -->
    <CreateProperty Condition="'$(ExitCode)' == 0" Value="true">
      <Output TaskParameter="Value" PropertyName="ServiceFound" />
    </CreateProperty>

    <Message Text="ServiceFound: $(ServiceFound)" Importance="high" />
    <Message Text="ProjectDir: $(ProjectDir)" Importance="high" />

    <!-- Create the service if the boolean is false (service not found) -->
    <!--
    <Exec
      Condition="$(ServiceFound) == 'false'"
      Command="sc.exe create $(ServiceName) type= own displayname='$(ServiceDisplayName)' binpath='$(ServiceBinPath)' obj= 'NT AUTHORITY\LocalService' password= ''"
      StandardOutputImportance="low"
      StandardErrorImportance="low"
    />
    -->

    <!-- Set the service's description -->
    <!--
    <Exec
      Condition="$(ServiceFound) == 'false'"
      Command="sc.exe description $(ServiceName) '$(ServiceDescription)'"
      StandardOutputImportance="low"
      StandardErrorImportance="low"
    />
    -->
  </Target>

</Project>
